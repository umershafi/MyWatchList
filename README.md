# WiredIn

## Introduction

A social media platform for movie lovers! Users can upload, view, rate, share, and comment on movies!

## Requirements

- Users can sign in and out using their Google account.
- Users can upload videos while signed in.
- Videos should be transcoded to multiple formats (e.g., 360p, 720p).
- Users can view a list of uploaded videos (signed in or not).
- Users can view individual videos (signed in or not).

## High-Level Design

![High-Level Design Diagram](architect.png) <!-- You can add an actual link to the diagram if available -->

### Video Storage (Google Cloud Storage)

Google Cloud Storage will be used to host raw and processed videos. It provides a scalable and cost-effective solution for handling large files.

### Video Upload Events (Cloud Pub/Sub)

Video uploads will trigger a message in a Cloud Pub/Sub topic. This provides a durability layer and asynchronous video processing.

### Video Processing Workers (Cloud Run)

Workers will process video transcoding using `ffmpeg` after receiving events from Pub/Sub. Cloud Run allows the system to scale up or down based on the workload.

### Video Metadata (Firestore)

Processed video metadata will be stored in Firestore, making it easy to retrieve and display video information (e.g., title, description).

### Video API (Firebase Functions)

A simple API built with Firebase Functions will allow video uploads and metadata retrieval. This can be expanded to support full CRUD operations.

### Web Client (Next.js / Cloud Run)

The front-end web client is built with Next.js and deployed using Cloud Run. It supports user sign-in and video uploads.

### Authentication (Firebase Auth)

User authentication is handled via Firebase Auth, integrated with Google Sign-In.

## Detailed Design

### 1. User Sign Up

- Users sign up using their Google account via Firebase Auth.
- Each user gets a unique ID and associated Firestore document for storing additional profile information (e.g., name, profile picture).
- User document creation is triggered server-side using Firebase Functions to ensure reliability.

### 2. Video Upload

- Only authenticated users can upload videos, which are associated with their account.
- Videos are uploaded directly to Google Cloud Storage using signed URLs generated by Firebase Functions.
- Signed URLs are only generated after the video file information (like extension) is provided.

### 3. Video Processing

- Video uploads are followed by a message published to a Cloud Pub/Sub topic.
- This allows for asynchronous processing and scaling of video processing workers.
- Once processed, videos are uploaded to a public Cloud Storage bucket, and metadata is stored in Firestore.

### Benefits of Pub/Sub:

- Decouples video uploads from processing.
- Messages are buffered until workers are available.
- Workers can be scaled dynamically.

### Noteworthy Limitations:

- Cloud Run requests are limited to a max timeout of 3600 seconds.
- Pub/Sub messages are redelivered after 600 seconds if unprocessed.
- No checks for illegal video content are performed in this version.

## Limitations & Future Work

This project has several limitations that could be addressed in future iterations:

- Cloud Run timeout restrictions.
- Video content moderation.
- Scalability improvements.

## References

- [Firebase Auth](https://firebase.google.com/docs/auth)
- [Cloud Storage Signed URLs](https://cloud.google.com/storage/docs/access-control/signed-urls)
- [Pub/Sub Push subscriptions](https://cloud.google.com/pubsub/docs/push)
- [Using Pub/Sub with Cloud Storage](https://cloud.google.com/storage/docs/pubsub-notifications)
- [Using Pub/Sub with Cloud Run](https://cloud.google.com/run/docs/tutorials/pubsub)
